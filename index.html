<!DOCTYPE html>
<html lang="es" >
<head>
    <meta charset="UTF-8">
    <title> Happy birthday Card</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <link rel="stylesheet" href="./style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

<div class="card" id="myCard">
    <div class="imgBox">
        <div class="bark"></div>
        <img src="card.jpg">
    </div>
    <div class="details">
        <h2 class="color3">¡FELIZ CUMPLEAÑOS!</h2>
        <p></p><h6>Hoy cumple años mi persona favorita, la más maravillosa, hermosa, dulce, inteligente, fantástica, alegre, especial, chula y hermosa persona que puede existir, que ilumina mi camino con su luz de luna. <br>Que este y todos los días sean especiales y bellos como tú, que Dios te siga llenando de bendiciones, logros, amor, alegría, fuerzas y siga cuidando esos ojitos tan hermosos que tienes y que tanto me encantan.<br> Muy felices 24 años, mi amor, que sea el primero de muchos cumpleaños que pueda pasar a tu hermoso lado, te mando un abrazo enorme, mis mejores deseos para ti hoy y siempre<br>PD: Esta es la página en la que estaba trabajando <br>PD 2: ¡Muchas felicidades!</h6> 
        <p class="text-right">¡Te amo!</p>
        <p class="text-right">CA ♥</p>
    </div>
</div>

<audio id="backgroundAudio" src="music.mp3" muted loop></audio> 

<button id="floatingMusicToggle" class="is-paused">
    <i id="musicIcon" class="fas fa-play fa-volume-xmark"></i> 
</button>

<script>
    const audio = document.getElementById('backgroundAudio');
    const button = document.getElementById('floatingMusicToggle');
    const icon = document.getElementById('musicIcon');
    const card = document.getElementById('myCard'); // ⬅️ Obtener la tarjeta
    
    // Estado inicial: Pausa y Mute.
    let isPlaying = false;

    function updateIcon() {
        icon.className = ''; 

        if (isPlaying) {
            icon.classList.add('fas', 'fa-pause');
            button.classList.remove('is-paused');
            button.classList.add('is-playing');
        } else {
            icon.classList.add('fas', 'fa-play');
            button.classList.remove('is-playing');
            button.classList.add('is-paused');
        }

        if (audio.muted) {
            icon.classList.add('fa-volume-xmark');
        } else {
            icon.classList.add('fa-volume-up');
        }
    }

    function toggleAudio() {
        if (audio.paused) {
            if (audio.muted) {
                audio.muted = false; 
            }
            
            audio.play()
                .then(() => {
                    isPlaying = true;
                    updateIcon();
                })
                .catch(error => {
                    // El navegador bloqueó la reproducción. Volvemos al estado inicial.
                    isPlaying = false;
                    audio.muted = true; 
                    updateIcon(); 
                });
            
        } else {
            audio.pause();
            audio.muted = true; // Silenciar al pausar
            isPlaying = false;
            updateIcon();
        }
    }

    // ------------------------------------------------------------------
    // ⬇️ SOLUCIÓN TÁCTIL PARA LA TARJETA (¡CLAVE PARA iOS!) ⬇️
    // ------------------------------------------------------------------
    card.addEventListener('click', function(e) {
        // Asegurarse de que no estamos tocando el botón de música
        if (!e.target.closest('#floatingMusicToggle')) {
            card.classList.toggle('flipped'); 
        }
    });
    
    // ------------------------------------------------------------------

    // Asignar el evento al botón de audio
    button.addEventListener('click', toggleAudio);

    // Inicializar el ícono y color al cargar
    updateIcon(); 
</script>

</body>
</html>